# Physical inactivity exacerbates pathologic inflammatory signaling and lymphopenia in a systemic lupus cohort

This repository contains the code to reproduce the analyses the paper.

The single-cell gene count data (h5ad object) was downloaded from https://cellxgene.cziscience.com/collections/436154da-bcf1-4130-9c8b-120ff9a888f2. Please note that you need a lot of RAM to analyze it (we used 72GB of RAM).

Paper: **link to be added after official publication**

## Code

All codes are stored in the folder [src](src)

[h5ad_subsetting.ipynb](src/h5ad_subsetting.ipynb): used to extract lupus patients' single cells from the h5ad object.
* This notebook uses the list of lupus patient IDs from [this file](data/subjectID.csv) (named `CLUES_metadata_stress_7.14.22_simplified_subjectid_only.xlsx` inside the notebook). A number of patient IDs from this list are not present in the h5ad object, and are excluded.

[make_pseudobulk_count.ipynb](src/make_pseudobulk_count.ipynb): used to prepare pseudobulk gene count matrices for lupus patients.
* This notebook uses the output of [h5ad_subsetting.ipynb](src/h5ad_subsetting.ipynb).
* The pseudobulk count matrices are stored in the folder [pseudobulk_counts](pseudobulk_counts).

[singlecell_analysis_physact.ipynb](src/singlecell_analysis_physact.ipynb): used to extract lupus patients from the h5ad object, make UMAP plots, and analyze the cell type proportion.
* This notebook uses [this metadata file](data/metadata.csv).

[pseudobulk_DE.Rmd](src/pseudobulk_DE.Rmd): used to perform differential expression analysis and gene set enrichment analysis.
* This R code uses [this metadata file](data/metadata.csv). Steroid information is stored in [this file](data/steroids.csv).
* Igenuity pathway analysis (IPA) results are stored in [this file](data/T4_edgeR-LRT_inactive-up_age-biologicalsex-race-covariate_fdr1.0_cytokine-z2.0-fdr0.1.xls) and [this file](data/T8_edgeR-LRT_inactive-up_age-biologicalsex-race-covariate_fdr1.0_cytokine-z2.0-fdr0.1.xls).

## Figures

The figures and tables output by the codes are stored in folder [out](out)

Figure 2: generated by [singlecell_analysis_physact.ipynb](src/singlecell_analysis_physact.ipynb)
* A: [umap_cell_type.png](out/umap_cell_type.png)
* B: [umap_inactive.png](out/umap_inactive.png)
* C: [top4-cell-type_inactive.pdf](out/top4-cell-type_inactive.pdf)
* D: [umap_cell_type_fine.png](out/umap_cell_type_fine.png)
* E: [top4-fine-cell-type_inactive.pdf](out/top4-fine-cell-type_inactive.pdf)

Figure 3: generated by [pseudobulk_DE.Rmd](src/pseudobulk_DE.Rmd)
* A: [nDEgenes.svg](out/nDEgenes.svg)
* B: [volcano_plot_T4-T8.svg](out/volcano_plot_T4-T8.svg)
* C: [hallmark-gsea_T4-T8.svg](out/hallmark-gsea_T4-T8.svg)
* D: [T4_IPA-cytokine.svg](out/T4_IPA-cytokine.svg)
* E: [T8_IPA-cytokine.svg](out/T8_IPA-cytokine.svg)

Figure 4: generated by [pseudobulk_DE.Rmd](src/pseudobulk_DE.Rmd)
* [hallmark-gsea_cnetplot_T4.pdf](out/hallmark-gsea_cnetplot_T4.pdf)

Supp Figure 1: generated by [singlecell_analysis_physact.ipynb](src/singlecell_analysis_physact.ipynb)
* A: [remaining-cell-type_inactive.pdf](out/remaining-cell-type_inactive.pdf)
* B: [remaining-fine-cell-type_inactive.pdf](out/remaining-fine-cell-type_inactive.pdf)

Supp Figure 2: generated by [pseudobulk_DE.Rmd](src/pseudobulk_DE.Rmd)
* [hallmark-gsea_cM-B.svg](out/hallmark-gsea_cM-B.svg)

Supp Figure 3: generated by [pseudobulk_DE.Rmd](src/pseudobulk_DE.Rmd)
* [hallmark-gsea_steroid_T4-T8.svg](out/hallmark-gsea_steroid_T4-T8.svg)
