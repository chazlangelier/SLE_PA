# Physical activity and lupus

This repository contains the code for the paper **Physical inactivity exacerbates pathologic inflammatory signaling and lymphopenia in a systemic lupus cohort**.

The single-cell gene count data (h5ad object) was downloaded from https://cellxgene.cziscience.com/collections/436154da-bcf1-4130-9c8b-120ff9a888f2. Please note that you need a lot of RAM to analyze it (we used 72GB of RAM).

## Code

src/20220718_subsetting.ipynb: used to extract lupus patients' single cells from the h5ad object.
* This notebook uses the list of lupus patient IDs from [this file](data/CLUES_metadata_stress_7.14.22_simplified_subjectid_only.xlsx). A number of patient IDs from this spreadsheet are not present in the h5ad object.

src/20220929_make_pseudobulk_count.ipynb: used to prepare pseudobulk gene count matrices for lupus patients.
* The pseudobulk count matrices are stored in the folder [pseudobulk_counts](pseudobulk_counts)

src/20240201_analysis_physact.ipynb: used to extract lupus patients from the h5ad object, and analyze the cell type proportion.

src/20230216_sc_DE_testing_lupus_only_physact.Rmd: used to perform differential expression analysis and gene set enrichment analysis.
* This R code uses [this metadata file](data/clues_t1_plust2t3PA_N-123_12.7.22.csv). Steroid information is stored in [this file](data/CLUES_steroids_baseline.xlsx).
* Igenuity pathway analysis (IPA) results are stored in [this file](data/T4_edgeR-LRT_inactive-t3-up_age-biologicalsex-race-covariate_fdr1.0_cytokine-z2.0-fdr0.1.xls) and [this file](data/T8_edgeR-LRT_inactive-t3-up_age-biologicalsex-race-covariate_fdr1.0_cytokine-z2.0-fdr0.1.xls)

## Figures

Figure 2: generated by src/20240201_analysis_physact.ipynb
* A: 20230913_analysis_physact_umap_cell_type.png
* B: 20230913_analysis_physact_umap_inactive-t3.png
* C: 20240201_analysis_physact_top4-cell-type_inactive-t3.pdf
* D: 20240201_analysis_physact_umap_cell_type_fine.png
* E: 20240201_analysis_physact_top4-fine-cell-type_inactive-t3.pdf

Figure 3: generated by src/20230216_sc_DE_testing_lupus_only_physact.Rmd
* A: nDEgenes.svg
* B: volcano_plot_T4-T8.svg
* C: hallmark-gsea_T4-T8.svg
* D: T4_IPA-cytokine.svg
* E: T8_IPA-cytokine.svg

Figure 4: generated by src/20230216_sc_DE_testing_lupus_only_physact.Rmd
* hallmark-gsea_cnetplot_T4.pdf

Supp Figure 1: generated by src/20240201_analysis_physact.ipynb
* A: 20230913_analysis_physact_remaining-cell-type_inactive-t3.pdf
* B: 20230913_analysis_physact_umap_cell_type_fine.png
* C: 20230913_analysis_physact_fine-cell-type_inactive-t3.pdf

Supp Figure 2: generated by src/20230216_sc_DE_testing_lupus_only_physact.Rmd
* hallmark-gsea_cM-B.svg

Supp Figure 3: generated by src/20230216_sc_DE_testing_lupus_only_physact.Rmd
* hallmark-gsea_steroid_T4-T8.svg
